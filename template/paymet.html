<body onload="payWithPaystack()">
    <!-- <script src="https://js.paystack.co/v1/inline.js"></script>
    <script>
    window.onload=function(){
    payWithPaystack();
    };
    function payWithPaystack(){
    var handler = PaystackPop.setup({
    key: 'pk_test goes here',
    email:'{{email}}',
    amount:'{{amount}}00',
    currency: "NGN",
    metadata: {
    custom_fields: [
    {
    display_name: "Mobile Number",
    variable_name: "mobile_number",
    value: "{{phone}}"
    }
    ]
    },
    callback: function(response){
    alert('success. transaction ref is ' + response.reference);
    },
    onClose: function(){
    alert('window closed');
    }
    });
    handler.openIframe();
    }
    </script> -->

    <script>
        document.addEventListener("DOMContentLoaded", (event) => {
     // Add an event listener for when the user clicks the submit button to pay
       document.getElementById("submit").addEventListener("click", (e) => {
         e.preventDefault();
         const PBFKey = "FLWPUBK_TEST-5d7a3aa9000594cbc0eee175b520e6b6-X"; // paste in the public key from your dashboard here
         const txRef = ''+Math.floor((Math.random() * 1000000000) + 1); //Generate a random id for the transaction reference
         const email = document.getElementById('email').value;
         const amount= document.getElementById('amount').innerHTML;
         var fullname= document.getElementById('full_name').value;
         var address1= document.getElementById('address_1').value;
         var address2= document.getElementById('address_2').value;
         var country= document.getElementById('country').value;
         var state= document.getElementById('state').value;
         var address1= document.getElementById('zipcode').value;
         
   
       //   console.log(amount, 'okayyyf')
         
         
        
   
         // getpaidSetup is Rave's inline script function. it holds the payment data to pass to Rave.
     getpaidSetup({
         PBFPubKey: PBFKey,
         customer_email: email,
         amount:{{  amount }},
         currency: "NGN",  // Select the currency. leaving it empty defaults to NGN
         txref: txRef, // Pass your UNIQUE TRANSACTION REFERENCE HERE.
     
         onclose: function() {},
         callback: function(response) {
             flw_ref = response.tx.flwRef;// collect flwRef returned and pass to a server page to complete status check.
             console.log("This is the response returned after a charge", response);
             if(response.tx.chargeResponse =='00' || response.tx.chargeResponse == '0') {
             // redirect to a success page
             } else {
             // redirect to a failure page.
             }
         }
       });
     });
   });
   </script>
   <script type="text/javascript" src="https://api.ravepay.co/flwv3-pug/getpaidx/api/flwpbf-inline.js"></script> 
    </body>









    <!-- ========================== -->
    <!-- ========================== -->
    <!-- ========================== -->
    <!-- ========================== -->

    {% extends "base.html" %}
{% block body %}
<div class="container">
    <div class="d-flex flex-row justify-content-center align-items-center " style="min-height: 90vh;">
        <div class="col-md-6">
            <div class="bg-white shadow p-5">
                <h5 class="font-large-fixed">Amount : <span class=" font-large-fixed font-weight-bold color-primary">GH {{ payment.amount }}</span></h5>
                <hr>
                <form>
                    <script src="https://js.paystack.co/v1/inline.js"></script>
                    <button class="btn btn-large btn-success waves-effect waves-light" id="django-paystack-button" type="button" onclick="payWithPaystack()"> Pay </button>
                    <!-- <a href="{{ payment.get_delete_url }}" id="delete-payment" class="btn btn-danger">Delete</a> -->
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    document.getElementById("delete-payment").addEventListener('click', (e) => {
        if (!confirm("Are you sure you want to delete this payment!")) {
            e.preventDefault();
        }
    });
</script>
<script>
    function payWithPaystack() {
        let currency = "GHS"
        let plan = ""
        let ref = "{{ payment.ref }}"
        let obj = {
            key: '{{ paystack_public_key }}',
            email: '{{ payment.email }}',
            amount: {{ payment.amount_value }},
            ref:ref,    
            callback: function (response) {
                window.location.href = "{% url 'index:home'  %}?amount={{ payment.amount_value }}&trxref=" + response.trxref
            }
        }      
        
        if(Boolean(currency)){
            obj.currency = currency.toUpperCase()
        }
        if(Boolean(plan)){
            obj.plan = plan
        }
        var handler = PaystackPop.setup(obj);
        handler.openIframe();
        console.log({currency,plan,ref})
    }
</script>

{% endblock %}











<div class="form-field col-lg-6">
    {{  payment_form.full_name|as_crispy_field }}
</div>
<div class="form-field col-lg-6">
    {{  payment_form.email|as_crispy_field }}
</div>

<div class="col-lg-12">{{  payment_form.address|as_crispy_field }}
</div>
<div class="col-lg-12">
    {{  payment_form.address2|as_crispy_field }}
</div>
<div class="col-lg-12">
    {{  payment_form.country|as_crispy_field }}
</div>
<div class="col-lg-6 ">
    {{  payment_form.state|as_crispy_field }}
</div>
<div class="col-lg-6 ">
    {{  payment_form.city|as_crispy_field }}
</div>
<div class="col-lg-6 ">
    {{  payment_form.zipcode|as_crispy_field }}
</div>
<div class="col-lg-6 ">
    {{  payment_form.phone|as_crispy_field }}
</div>